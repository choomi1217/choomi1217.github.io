---
title:  "[Toy Project - Neighbor] JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ Record ì— ëŒ€í•´"

categories:
  - project
tags:
  - [neighbor]

toc: true
toc_sticky: true

breadcrumbs: true

date: 2023-08-25
last_modified_at: 2023-08-25
---


### ğŸ¤”RecordëŠ” ë¶ˆë³€, ê·¸ëŸ¼ ì‚¬ìš©ìì˜ ë°ì´í„° ì—…ë°ì´íŠ¸ëŠ”?

ì´ë©”ì¼ ì¸ì¦ì‹œ `account` ì˜ `emailVerificationStatus` ë¥¼ ë³€ê²½í•´ì¤˜ì•¼ í•˜ëŠ” ë¡œì§ì´ ìˆìŠµë‹ˆë‹¤.

`Account`ë¥¼ recordë¡œ í–ˆë”ë‹ˆ ë³€ê²½ì´ ì•ˆë©ë‹ˆë‹¤.

> recordëŠ” ë¶ˆë³€ ê°ì²´ë¡œ abstractë¡œ ì„ ì–¸í•  ìˆ˜ ì—†ìœ¼ë©° ì•”ì‹œì ìœ¼ë¡œ finalë¡œ ì„ ì–¸ë©ë‹ˆë‹¤. í•œ ë²ˆ ê°’ì´ ì •í•´ì§€ë©´ setterë¥¼ í†µí•´ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ìœ¼ë©° ìƒì†ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
> 

```java
public void emailVerification(String token, String email) {
    Account account = accountRepository.findByEmail(email);
    if (account.emailVerificationStatus()== AccountEmailVerificationStatus.VERIFIED) {
        throw new IllegalArgumentException("Already Verified");
    }
    if(token.equals(account.emailVerificationToken())) {
        account.verifyEmail();
    }else{
        throw new IllegalArgumentException("Invalid Token");
    }
}
```

```java
public record Account (Long accountId, String email, String password, String emailVerificationToken , AccountEmailVerificationStatus emailVerificationStatus, AccountActiveStatus activeStatus) {

    public Account(String email, String password) {
        this(null,
                email,
                password,
                generateEmailVerificationToken(),
                AccountEmailVerificationStatus.NON_VERIFIED, AccountActiveStatus.ACTIVE);
    }

    private static String generateEmailVerificationToken() {
        return UUID.randomUUID().toString();
    }

    public boolean verifyEmail(String token) {
        return token.equals(emailVerificationToken);
    }

}
```

---

### ğŸ”§ìƒˆë¡œìš´ ê°ì²´

```java
public AccountResponse emailVerification(String token, String email) {
        Account account = accountRepository.findByEmail(email);
        if (account.emailVerificationStatus()== AccountEmailVerificationStatus.VERIFIED) {
            throw new IllegalArgumentException("Already Verified");
        }
        if(token.equals(account.emailVerificationToken())) {
            Account verified = account.verifyEmail();
            accountRepository.update(verified);
            return new AccountResponse(verified.email(), verified.emailVerificationStatus(), verified.activeStatus());
        }else{
            throw new IllegalArgumentException("Invalid Token");
        }
    }
```

```java
public Account verifyEmail() {
    return new Account(
            accountId,
            email,
            password,
            emailVerificationToken,
            AccountEmailVerificationStatus.VERIFIED,
            activeStatus
    );
}
```

-----

# rec

citizen ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ë˜ ë„ì¤‘ `record` ì˜ ì—­í• ì— ëŒ€í•´ ìƒê°í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```java
public record CitizenResponse(
        String nickname,
        String phoneNumber,
        AddressResponse address,
        HobbyResponse hobby
) {
    public CitizenResponse(Citizen saved) {
        this(saved.nickname(), saved.phoneNumber(), new AddressResponse(saved.address()), new HobbyResponse(saved.hobby()));
    }
}
```

ì±…ì„ ë¶„ë¦¬(Separation of Responsibility)ì™€ ë‹¨ì¼ ì±…ì„ ì›ì¹™(Single Responsibility Principle)ì„ ë”°ë¥´ë©´ ì•„ë˜ì™€ ê°™ì€ Factory í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ë” ë§Œë“œëŠ”ê²Œ ë§ë‹¤ê³  ìƒê° ì¤‘ì…ë‹ˆë‹¤ë§Œ.. ğŸ¤”

ë ˆì½”ë“œë§ˆë‹¤ Factory í´ë˜ìŠ¤ê°€ í•˜ë‚˜ì”© ë” ìƒê¸°ê³  ì´ í´ë˜ìŠ¤ë“¤ë„ ê´€ë¦¬ í•  ê²ƒì„ ìƒê°í•˜ë©´.. ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.

```java
public class CitizenResponseFactory {
    public static CitizenResponse from(Citizen saved) {
        return new CitizenResponse(
            saved.nickname(),
            saved.phoneNumber(),
            new AddressResponse(saved.address()),
            new HobbyResponse(saved.hobby())
        );
    }
}
```
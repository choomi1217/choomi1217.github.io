---
title:  "[Toy Project - Neighbor] ë³µì¡í•œ JPA ì—°ê´€ê´€ê³„ì— ëŒ€í•´"

categories:
  - neighbor
tags:
  - [neighbor]

toc: true
toc_sticky: true

breadcrumbs: true

date: 2023-08-25
last_modified_at: 2023-08-25
---


account ë“±ë¡ í›„ citizenì„ ë“±ë¡í•˜ë ¤ê³  ë³´ë‹ˆ ê´€ë ¨ëœ í…Œì´ë¸”ë“¤ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤.

JPAì— ìµìˆ™í•˜ì§€ ì•Šì•„ì„œ ì¡°ê¸ˆ ë‚¯ì„  ìƒí™©ì…ë‹ˆë‹¤. ğŸ¥²

![Untitled](image/1.png)

---

# ê³ ë¯¼ì 

1. citizen ë“±ë¡
  - ë“±ë¡ì „ address ì¡°íšŒê°€ ì„ í–‰ ë˜ì–´ì•¼ë§Œ í•©ë‹ˆë‹¤.
  - ê·¼ë° jpaì—ì„œ ë“±ë¡í•˜ë ¤ê³  ë³´ë‹ˆ citizenì— address entityê°€ í•„ìš”í•˜ê³  addressì—” sido, sigungu, eupmyeondong entityê°€ í•„ìš”í•©ë‹ˆë‹¤.


---

# ğŸ”¥Â ì—°ê´€ê´€ê³„ì— ëŒ€í•´ ê³µë¶€í•˜ì§€ ì•Šê³  Jpaë¥¼ êµ¬ì„± í–ˆì„ë•Œ

### Account

```java
@Entity
public class AccountEntity {
    @Id
    @GeneratedValue(strategy = jakarta.persistence.GenerationType.IDENTITY)
    private Long accountId;
    private String email;
    private String password;
    @Enumerated(EnumType.STRING)
    private AccountEmailVerificationStatus emailVerificationStatus;
    @Enumerated(EnumType.STRING)
    private AccountActiveStatus activeStatus;
    @OneToMany(mappedBy = "accountEntity")
    private List<CitizenEntity> citizens = new ArrayList<>();

    private String emailVerificationToken;

    public AccountEntity() {}

    public AccountEntity(String email, String password, AccountEmailVerificationStatus emailVerificationStatus, AccountActiveStatus activeStatus) {
        this.email = email;
        this.password = password;
        this.emailVerificationStatus = emailVerificationStatus;
        this.activeStatus = activeStatus;
    }

    public AccountEntity(Account account) {
        this.email = account.email();
        this.password = account.password();
        this.emailVerificationStatus = account.emailVerificationStatus();
        this.activeStatus = account.activeStatus();
        emailVerificationToken = account.emailVerificationToken();
    }

    public Account toDomain() {
        return new Account(this.accountId ,this.email, this.password, this.emailVerificationToken, this.emailVerificationStatus, this.activeStatus);
    }

    public void update(AccountUpdateRequest updateRequest) {
        this.email = updateRequest.email();
    }

    public void update(Account account) {
        this.email = account.email();
        this.password = account.password();
        this.emailVerificationStatus = account.emailVerificationStatus();
        this.activeStatus = account.activeStatus();
        emailVerificationToken = account.emailVerificationToken();
    }

    public void delete() {
        this.activeStatus = AccountActiveStatus.DELETED;
    }
}
```

### Citizen

```java
@Entity
public class CitizenEntity {

    @Id
    @GeneratedValue(strategy = jakarta.persistence.GenerationType.IDENTITY)
    private Long citizenId;
    private String nickname;
    private String phoneNumber;
    private LocalDate createdAt;
    private CitizenActiveStatus activeStatus;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name="account_id")
    private AccountEntity accountEntity;

    @OneToMany(mappedBy = "addressEntity", cascade = CascadeType.ALL)
    private List<AddressEntity> addressEntity;

    @OneToOne(mappedBy = "hobbyEntity", cascade = CascadeType.ALL)
    private HobbyEntity hobbyEntity;

    public CitizenEntity(Citizen citizen) {
        this.nickname = citizen.nickname();
        this.createdAt = citizen.createdAt();
        this.phoneNumber = citizen.phoneNumber();
        this.activeStatus = CitizenActiveStatus.ACTIVE;
    }

    public CitizenEntity() {}

    public Citizen toDomain() {

        return null;
    }

    public void delete() {
        this.activeStatus = CitizenActiveStatus.DELETED;
    }
}
```

### Address

```java
@Entity
public class AddressEntity {
    @Id
    @GeneratedValue(strategy = jakarta.persistence.GenerationType.IDENTITY)
    private Long addressId;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "citizen_id")
    private CitizenEntity citizen;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "si_do_id")
    private SiDoEntity siDo;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "si_gun_gu_id")
    private SiGunGuEntity siGunGu;

    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "eup_myeon_dong_id")
    private EupMyeonDongEntity eupMyeonDong;

}
```

### Hobby

```java
@Entity
public class HobbyEntity {
    @Id
    private Long id;
    private String hobby;
    private LocalDate createdAt;

}
```

---

### 1. Citizenê³¼ Account

- N : 1 ì˜ ì–‘ë°©í–¥ ê´€ê³„
- Citizneì´ ì£¼ì¸
- Citizenì´ fkë¡œ Accountì˜ pkë¥¼ ê°€ì§‘ë‹ˆë‹¤.
- Citizenì— `@ManyToOne` , Accountì—ëŠ” `mappedBy`

### 2. Citizenê³¼ Hobby

- N : M ì˜ ê´€ê³„ ( 1 : N, N : 1 )
- Citizenì€ Hobbyë¥¼ ì—¬ëŸ¬ê°œ ê°€ì§ˆ ìˆ˜ ìˆê³  HobbyëŠ” ì—¬ëŸ¬ê°œì˜ Citizenì— ì†í•  ìˆ˜ ìˆë‹¤.
- Citizneì´ ì£¼ì¸
- ì—°ê´€ í…Œì´ë¸” ìƒì„±
- Citizen

### 3. Citizenê³¼ Address

- 1 : N ì˜ ë‹¨ë°©í–¥ ê´€ê³„
- Citizenì€ Addressë¥¼ ì—¬ëŸ¬ê°œ ê°€ì§€ì§€ë§Œ AddressëŠ” Citizenì— ëŒ€í•œ ì •ë³´ë¥¼ ëª°ë¼ë„ ë©ë‹ˆë‹¤.
- Citizenì´ ì£¼ì¸

# âœ¨Â ê³ ì¹œ ì 

- Citizenê³¼ Hobbyì˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ ë§¤í•‘
  - ê´€ê³„ í…Œì´ë¸”ì„ ë”°ë¡œ Entityë¡œ ë§Œë“¤ì–´ ë‚˜ì¤‘ì—ë„ ì»¬ëŸ¼ì„ ì¶”ê°€ í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½
  - citizenId, hobbyIdë¥¼ PKë¡œ ì‚¬ìš©
  - `CitizenHobbyEntity` ì˜ ëª©ì ì€ ê´€ê³„ í…Œì´ë¸”ì˜ ì´ìš©ì´ë¯€ë¡œ ë”°ë¡œ repositoryë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```java
@Entity
public class CitizenEntity {

    @Id
    @GeneratedValue(strategy = jakarta.persistence.GenerationType.IDENTITY)
    private Long citizenId;
    private String nickname;
    private String phoneNumber;
    private LocalDate createdAt;
    private CitizenActiveStatus activeStatus;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name="account_id")
    private AccountEntity accountEntity;

    @OneToMany(mappedBy = "addressEntity", cascade = CascadeType.ALL)
    private List<AddressEntity> addressEntity;

    @OneToMany(mappedBy = "hobbyEntity", cascade = CascadeType.ALL)
    private List<HobbyEntity> hobbyEntity;

    public CitizenEntity(Citizen citizen) {
        this.nickname = citizen.nickname();
        this.createdAt = citizen.createdAt();
        this.phoneNumber = citizen.phoneNumber();
        this.activeStatus = CitizenActiveStatus.ACTIVE;
    }

    public CitizenEntity() {}

    public Citizen toDomain() {

        return null;
    }

    public void delete() {
        this.activeStatus = CitizenActiveStatus.DELETED;
    }
}
```

```java
@Getter
@Entity
@IdClass(CitizenHobbyId.class)
public class CitizenHobbyEntity {
    @Id
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "citizenId")
    private CitizenEntity citizen;

    @Id
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "hobbyId")
    private HobbyEntity hobby;
}
```

```java
public class CitizenHobbyId implements Serializable {
    private Long citizenId;
    private Long hobbyId;

    @Override
    public boolean equals(Object obj) {
        return super.equals(obj);
    }

    @Override
    public int hashCode() {
        return super.hashCode();
    }
}
```

```java
@Entity
public class HobbyEntity {
    @Id
    private Long hobbyId;
    private String hobby;
    private LocalDate createdAt;

}
```


------

# ì‹œë„, ì‹œêµ°êµ¬, ìë©´ë™

ì˜ˆì‹œ) 1154510100 : ì„œìš¸íŠ¹ë³„ì‹œ ê¸ˆì²œêµ¬ ê°€ì‚°ë™

ì‹œë„ëŠ” ë¬´ì¡°ê±´ ì „ì²´ ì¡°íšŒ

- /address/sido

ì‹œêµ°êµ¬ ì¡°íšŒ

- /address/sigungu?sido=11

ìë©´ë™ ì¡°íšŒ

- /address/eupmyeondong?sido=11&sigungu=545

```java
@Repository
@RequiredArgsConstructor
public class AddressDao implements AddressRepository {
    private final AddressJpaRepository addressJpaRepository;
    private final SiDoJpaRepository siDoJpaRepository;
    private final SiGunGuJpaRepository siGunGuJpaRepository;
    private final EupMyeonDongJpaRepository eupMyeonDongJpaRepository;

    @Override
    public AddressResponse save(Address address) {
        AddressEntity addressEntity = addressJpaRepository.save();
        return addressEntity.toDomain();
        return null;
    }

    @Override
    public List<SiDo> getSiDoList() {
        List<SiDoEntity> all = siDoJpaRepository.findAll();
        return all.stream().map(SiDoEntity::toDomain).collect(Collectors.toList());
    }

    @Override
    public List<SiGunGu> getSiGunGuList(String sido) {
        List<SiGunGuEntity> all = siGunGuJpaRepository.findBySido(sido);
        return all.stream().map(SiGunGuEntity::toDomain).collect(Collectors.toList()));
    }

    @Override
    public List<EupMyeonDong> getEupMyeonDongList(String sido, String sigungu) {
        List<EupMyeonDongEntity> all = eupMyeonDongJpaRepository.findBySidoAndSigungu(sido, sigungu);
        return all.stream().map(EupMyeonDongEntity::toDomain).collect(Collectors.toList());
    }
}
```

ìœ„ì™€ ê°™ì´ ë§Œë“¤ê³  ë³´ë‹ˆ ì‹œêµ°êµ¬ì—ì„  ì‹œë„ ì½”ë“œë¥¼, ìë©´ë™ì—ì„  ì‹œë„, ì‹œêµ°êµ¬ ì½”ë“œë¥¼ ê°€ì§€ê³  ìˆëŠ”ê²Œ ì¡°íšŒì‹œ í¸í•  ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

ì´ê±¸ JPAë¡œ ì–´ë–»ê²Œ í’€ì–´ì•¼ í•˜ëŠ”ì§€ê°€ ê³ ë¯¼ì…ë‹ˆë‹¤.


---

ì°¸ê³ 

[JPA ì—°ê´€ ê´€ê³„ í•œë°©ì— ì •ë¦¬ (ë‹¨ë°©í–¥/ì–‘ë°©í–¥, ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸, ì¼ëŒ€ì¼, ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ë‹¤)](https://jeong-pro.tistory.com/231)

[](https://cs-ssupport.tistory.com/482)




